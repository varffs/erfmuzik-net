function getRandomInt(e,a){return Math.floor(Math.random()*(a-e+1))+e}function playAudio(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!("AudioContext"in window))return void alert("Your browser does not yet support the Web Audio API");audioContext=new AudioContext,processor=audioContext.createScriptProcessor(2048,1,1),analyser=audioContext.createAnalyser(),analyser.smoothingTimeConstant=.8,analyser.fftSize=1024,analyser.connect(audioContext.destination),binCount=analyser.frequencyBinCount,levelBins=Math.floor(binCount/levelsCount),freqByteData=new Uint8Array(binCount),timeByteData=new Uint8Array(binCount);for(var e=256,a=0;e>a;a++)levelHistory.push(0);source=audioContext.createBufferSource(),source.connect(analyser);var n=new XMLHttpRequest;n.open("GET",sampleAudioURL,!0),n.responseType="arraybuffer",n.onload=function(){audioBuffer=audioContext.createBuffer(n.response,!1),source.buffer=audioBuffer,source.loop=!0,source.noteOn(0),isPlayingAudio=!0},n.send()}function analysis(){analyser.getByteFrequencyData(freqByteData),analyser.getByteTimeDomainData(timeByteData);for(var e=0;binCount>e;e++)waveData[e]=(timeByteData[e]-128)/128*volSens;for(var e=0;levelsCount>e;e++){for(var a=0,n=0;levelBins>n;n++)a+=freqByteData[e*levelBins+n];levelsData[e]=a/levelBins/256*volSens}for(var a=0,n=0;levelsCount>n;n++)a+=levelsData[n];level=a/levelsCount,levelHistory.push(level),levelHistory.shift(1)}function setup3d(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),renderer=new THREE.WebGLRenderer,renderer.shadowMapEnabled=!0,renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor("#FFFFFF"),document.body.appendChild(renderer.domElement);var e=new THREE.HemisphereLight("#FFFFFF","#000000",.8);e.castShadow=!0,scene.add(e);var a=new THREE.SpotLight(16777215);a.position.set(100,1e3,100),a.castShadow=!0,a.shadowMapWidth=1024,a.shadowMapHeight=1024,a.shadowCameraNear=500,a.shadowCameraFar=4e3,a.shadowCameraFov=30,scene.add(a);var n=new THREE.MeshPhongMaterial({color:16711680}),t=new THREE.STLLoader;t.addEventListener("load",function(e){var a=e.content;mesh=new THREE.Mesh(a,n),mesh.castShadow=!0,mesh.receiveShadow=!0,console.log(mesh),scene.add(mesh),console.log(scene)}),t.load("dist/assets/stl/girder-cube.stl"),camera.position.z=10}function render(){if(limitFrames>frames){if(requestAnimationFrame(render),renderer.render(scene,camera),isPlayingAudio){analysis();var e=waveData[getRandomInt(50,60)]/5,a=waveData[getRandomInt(430,460)]/5;mesh&&(mesh.rotation.x+=e,mesh.rotation.y+=a)}else mesh&&(mesh.rotation.x+=.01,mesh.rotation.y+=.01);frames++}}var limitFrames=5e3,frames=0,source,buffer,audioBuffer,dropArea,audioContext,processor,analyser,sampleAudioURL="dist/assets/mp3/Lo2tha.mp3",isPlayingAudio=!1,waveData=[],levelsData=[],level=0,bpmTime=0,ratedBPMTime=550,levelHistory=[],bpmStart,freqByteData,timeByteData,levelsCount=4,volSens=1,scene,camera,renderer,mesh,mesh2;setup3d(),render(),$(window).on({mousewheel:function(e){camera.position.z+=e.originalEvent.wheelDeltaY/100}});