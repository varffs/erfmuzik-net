function getRandomInt(e,a){return Math.floor(Math.random()*(a-e+1))+e}window.AudioContext=window.AudioContext||window.webkitAudioContext;var source,buffer,audioBuffer,dropArea,audioContext,processor,analyser,sampleAudioURL="dist/assets/mp3/ERFMUZIK-VOL1-SOUNDSCAPE.mp3",isPlayingAudio=!1,waveData=[],levelsCount=4,levelHistory=[],volSens=1,scene,camera,renderer,mesh,loaderDiv=$("#loader"),opacity=.99,audio={init:function(){audioContext=new AudioContext,analyser=audioContext.createAnalyser(),analyser.smoothingTimeConstant=.8,analyser.fftSize=1024,analyser.connect(audioContext.destination),binCount=analyser.frequencyBinCount,levelBins=Math.floor(binCount/levelsCount),freqByteData=new Uint8Array(binCount),timeByteData=new Uint8Array(binCount),source=audioContext.createBufferSource(),source.connect(analyser);var e=new XMLHttpRequest;e.open("GET",sampleAudioURL,!0),e.responseType="arraybuffer",e.onreadystatechange=function(){2==e.readyState?loader.small():3==e.readyState?loader.small():4==e.readyState&&loader.big()},e.onload=function(){audioContext.decodeAudioData(e.response,function(e){source.buffer=e,source.start(0),isPlayingAudio=!0,loader.finished()},function(e){console.log(e)})},e.send()},analyse:function(){analyser.getByteTimeDomainData(timeByteData);for(var e=0;binCount>e;e++)waveData[e]=(timeByteData[e]-128)/128*volSens}},threed={init:function(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera.position.z=8,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.shadowMapEnabled=!0,renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0,0),window.addEventListener("resize",function(){var e=window.innerWidth,a=window.innerHeight;renderer.setSize(e,a),camera.aspect=e/a,camera.updateProjectionMatrix()}),document.body.appendChild(renderer.domElement);var e=new THREE.HemisphereLight("#FFFFFF","#000000",.8);scene.add(e);var a=new THREE.SpotLight(16777215);a.position.set(1e3,100,100),a.castShadow=!0,a.shadowMapWidth=1024,a.shadowMapHeight=1024,a.shadowCameraNear=500,a.shadowCameraFar=4e3,a.shadowCameraFov=30,scene.add(a);var n=new THREE.SpotLight(16777215);n.position.set(-1e3,100,-100),scene.add(n);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(2==t.readyState)loader.small();else if(4==t.readyState&&(loader.big(),200==t.status||0===t.status)){var e=t.response;parseStlBinary(e),mesh.rotation.x=5,mesh.rotation.z=.25}},t.onerror=function(e){console.log(e)},t.open("GET","dist/assets/3d/girder-cube.stl",!0),t.responseType="arraybuffer",t.send(),threed.render()},render:function(){if(requestAnimationFrame(threed.render),renderer.render(scene,camera),isPlayingAudio){audio.analyse();var e=waveData[getRandomInt(50,60)]/6,a=waveData[getRandomInt(410,470)]/6,n=waveData[getRandomInt(150,250)]/15;mesh&&(mesh.rotation.x+=e>.005?e:.005,mesh.rotation.y+=a>.005?a:.005,camera.position.z<3.6&&(camera.position.z=camera.position.z*(n+1.75)),camera.position.z=camera.position.z*(n+1))}else mesh&&(mesh.rotation.x+=.005,mesh.rotation.y+=.005)}},loader={init:function(){loaderDiv.show()},big:function(){opacity-=.07,loaderDiv.css("background-color","rgba(0, 0, 0, "+opacity+")")},small:function(){opacity-=.002,loaderDiv.css("background-color","rgba(0, 0, 0, "+opacity+")")},finished:function(){loaderDiv.css("background-color","rgba(0, 0, 0, .1)").fadeOut(300)}};Detector.webgl?(loader.init(),"AudioContext"in window?audio.init():$(".nosupportalert").show(),threed.init()):($("html").css("background-image","url(dist/assets/img/background.png)"),$(".nosupportalert").show());