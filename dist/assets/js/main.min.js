function getRandomInt(e,n){return Math.floor(Math.random()*(n-e+1))+e}function playAudio(){audioContext=new AudioContext,analyser=audioContext.createAnalyser(),analyser.smoothingTimeConstant=.8,analyser.fftSize=1024,analyser.connect(audioContext.destination),binCount=analyser.frequencyBinCount,levelBins=Math.floor(binCount/levelsCount),freqByteData=new Uint8Array(binCount),timeByteData=new Uint8Array(binCount),source=audioContext.createBufferSource(),source.connect(analyser);var e=new XMLHttpRequest;e.open("GET",sampleAudioURL,!0),e.responseType="arraybuffer",e.onreadystatechange=function(){2==e.readyState?loader.progress(75):4==e.readyState&&loader.progress(65),console.log(e.readyState)},e.onload=function(){audioContext.decodeAudioData(e.response,function(e){source.buffer=e,source.start(0),isPlayingAudio=!0,loader.finished()},function(e){console.log(e)})},e.send()}function analysis(){analyser.getByteTimeDomainData(timeByteData);for(var e=0;binCount>e;e++)waveData[e]=(timeByteData[e]-128)/128*volSens}function setup3d(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera.position.z=8,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.shadowMapEnabled=!0,renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0,0),window.addEventListener("resize",function(){var e=window.innerWidth,n=window.innerHeight;renderer.setSize(e,n),camera.aspect=e/n,camera.updateProjectionMatrix()}),document.body.appendChild(renderer.domElement);var e=new THREE.HemisphereLight("#FFFFFF","#000000",.8);scene.add(e);var n=new THREE.SpotLight(16777215);n.position.set(1e3,100,100),n.castShadow=!0,n.shadowMapWidth=1024,n.shadowMapHeight=1024,n.shadowCameraNear=500,n.shadowCameraFar=4e3,n.shadowCameraFov=30,scene.add(n);var a=new THREE.SpotLight(16777215);a.position.set(-1e3,100,-100),scene.add(a);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(2==o.readyState)loader.progress(85);else if(4==o.readyState&&(loader.progress(80),200==o.status||0==o.status)){var e=o.response;parseStlBinary(e),mesh.rotation.x=5,mesh.rotation.z=.25}},o.onerror=function(e){console.log(e)},o.open("GET","dist/assets/3d/girder-cube.stl",!0),o.responseType="arraybuffer",o.send(),render()}function render(){if(requestAnimationFrame(render),renderer.render(scene,camera),isPlayingAudio){analysis();var e=waveData[getRandomInt(50,60)]/6,n=waveData[getRandomInt(410,470)]/6,a=waveData[getRandomInt(150,250)]/15;mesh&&(mesh.rotation.x+=e>.005?e:.005,mesh.rotation.y+=n>.005?n:.005,camera.position.z<3.6&&(camera.position.z=camera.position.z*(a+1.75)),camera.position.z=camera.position.z*(a+1))}else mesh&&(mesh.rotation.x+=.005,mesh.rotation.y+=.005)}window.AudioContext=window.AudioContext||window.webkitAudioContext;var source,buffer,audioBuffer,dropArea,audioContext,processor,analyser,sampleAudioURL="dist/assets/mp3/ERFMUZIK-VOL1-SOUNDSCAPE.mp3",isPlayingAudio=!1,waveData=[],levelsCount=4,levelHistory=[],volSens=1,scene,camera,renderer,mesh,loader={init:function(){$("#loader").show()},progress:function(e){$("#loader").css("background-color","rgba(0, 0, 0, ."+e+")")},finished:function(){$("#loader").fadeOut(300)}};Detector.webgl?(loader.init(),"AudioContext"in window?playAudio():$(".nosupportalert").show(),setup3d()):($("html").css("background-image","url(dist/assets/img/background.png)"),$(".nosupportalert").show());